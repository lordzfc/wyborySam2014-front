"use strict";angular.module("wyborySam2014",["nvd3","smart-table","ui.router","ui.bootstrap","wyborySam2014.area","wyborySam2014.charts","wyborySam2014.tables","wyborySam2014.utils","wyborySam2014.http","wyborySam2014.landingPage"]).constant("DEV_API_PREFIX","http://localhost:8081/api/").constant("HEROKU_API_PREFIX","wyreczamy-pkw.herokuapp.com/api/"),angular.module("wyborySam2014").config(["$stateProvider",function(t){t.state("stats-app",{url:"/app/{dataUrl}",controller:"wyborySam2014.area.ctrl",templateUrl:"area/area.ctrl.html"}).state("landing",{url:"",controller:"wyborySam2014.landing.ctrl",templateUrl:"landing_page/landing.ctrl.html"})}]),angular.module("wyborySam2014.area",[]),angular.module("wyborySam2014.area").controller("wyborySam2014.area.ctrl",["$scope","$rootScope","$http","$stateParams","httpService","urls",function(t,a,e,r,n,o){var i=function(a){var e=a.filter(function(a){return a.type===t.electionKind.type})[0];return e},l=function(a,e){t.showSpinner=!0,n.getStatsData(a).success(function(r){console.log(t.showSpinner),t.stats=r,t.siteName=e,o.changeDataUrl(a,t.dataUrl,"stats"),t.showSpinner=!1})};t.chartData={key:"",values:[]},t.dataUrl=r.dataUrl,t.showSpinner=!1,n.getAreasTree().success(function(a){t.tree=a;var e=o.decode(r.dataUrl),n=o.getSiteName(e);t.electionKind=o.getElectionKind(a,e),t.navTree=i(a),l(e,n)}),t.$watch("electionKind",function(e,r){e!==r&&void 0!==r&&(t.navTree=i(t.tree),a.$broadcast("area::electionTypeChange"),l(t.electionKind.url,"Warszawa"))});var c=a.$on("area::areaTypeChange",function(t,a,e){l(a,e)});t.$on("$destroy",c),t.menuIsVisible=function(){return t.openMenu===!1||t.openMenu===!0},t.menuIsOff=function(){return t.openMenu===!1},t.dropdownIsOff=function(){return t.electionKindsDropwn===!1},t.dropdownIsVisible=function(){return t.electionKindsDropwn===!1||t.electionKindsDropwn===!0},t.changeElectionKind=function(a){t.dataUrl=a.url,t.electionKind={name:a.name,type:a.type,url:a.url},n.getStatsData(a.url).success(function(a){t.statsData=a}),o.changeDataUrl(a.url,"stats"),t.electionKindsDropwn=!1},t.scrollTo=function(t){return"#charts"===t?void $(t).velocity("scroll",{axis:"y",offset:-140}):void $(t).velocity("scroll",{axis:"y",offset:-60})}}]),angular.module("wyborySam2014.charts",[]),angular.module("wyborySam2014.http",[]),angular.module("wyborySam2014.http").factory("httpService",["$http","DEV_API_PREFIX",function(t,a){var e={};return e.getAreasTree=function(){return t.get(a+"stats/areas-tree/")},e.getStatsData=function(e){return t.get(a+e)},e}]),angular.module("wyborySam2014.landingPage",[]),angular.module("wyborySam2014.landingPage").controller("wyborySam2014.landing.ctrl",["$scope","$state","httpService","urls",function(t,a,e,r){e.getAreasTree().success(function(a){t.tree=a}),t.data=null,t.gotoStats=function(t){t||(t="stats/city_council/circle-1/"),a.go("stats-app",{dataUrl:r.code(t)})}}]),angular.module("wyborySam2014.tables",[]),angular.module("wyborySam2014.utils",[]),angular.module("wyborySam2014.utils").factory("urls",["$location",function(t){var a={};return a.code=function(t){return t.replace(/\//g,".")},a.decode=function(t){return t.replace(/\./g,"/")},a.getSiteName=function(t,a){if(t)var e=t.split(a||"/"),r=e[e.length-2].split("-");return t&&"circle"===r[0]?"Okręg nr "+r[1]:t&&"circuit"===r[0]?"Obwód nr "+r[1]:t&&"district"===r[0]?r[1]:"Warszawa"},a.getElectionKind=function(t,a,e){if(!a||!t)return{name:"Wybory do Rady Miasta",type:"city_council",url:"stats/city_council/"};var r=a.split(e||"/")[1],n=t.filter(function(t){return t.type===r})[0];return{name:n.name,type:n.type,url:n.url}},a.changeDataUrl=function(e,r,n){var o=t.path().split("/");o.pop(),o.push(a.code(e)),t.path(o.join("/"))},a}]),angular.module("wyborySam2014.area").directive("mainCity",["$rootScope",function(t){return{scope:{election:"="},restrict:"E",templateUrl:"area/tree/main-city.dir.html",link:function(a,e,r,n){a.deactivateAllBranches=function(a,e){a.stopPropagation(),t.$broadcast("tree.city::deactivateAllBranches")},a.changeArea=function(a,e){a.stopPropagation(),t.$broadcast("area::areaTypeChange",e.url,e.name)}}}}]),angular.module("wyborySam2014.area").directive("areasTree",["$rootScope",function(t){return{scope:{tree:"="},restrict:"E",templateUrl:"area/tree/tree.dir.html",link:function(a,e,r,n){a.active=-1,a.activateDeactivate=function(t,e){return t.stopPropagation(),-1===a.active?void(a.active=e):void(a.active=-1)};var o=t.$on("area::electionTypeChange",function(){a.active=-1});a.$on("$destroy",o);var i=t.$on("tree.city::deactivateAllBranches",function(){a.active=-1});a.$on("$destroy",i),a.changeArea=function(a,e){a.stopPropagation(),t.$broadcast("area::areaTypeChange",e.url,e.name)}}}}]),angular.module("wyborySam2014.charts").controller("wyborySam2014.charts.mainCtrl",["$scope",function(t){t.options={chart:{type:"discreteBarChart",height:400,margin:{top:20,right:40,bottom:50,left:55},x:function(t){return t.label},y:function(t){return t.value},showValues:!1,valueFormat:function(t){return d3.format(",.2f%")(t)},duration:500,xAxis:{},yAxis:{axisLabelDistance:0}}}}]),angular.module("wyborySam2014.charts").directive("chartsView",[function(){return{scope:{data:"="},controller:"wyborySam2014.charts.mainCtrl",restrict:"E",templateUrl:"charts/main/charts.dir.html",link:function(t,a,e,r){t.chartData=[{key:"Cumulative Return",values:[]}],t.$watch("data",function(a,e){a!==e&&(t.chartData[0].values=_.map(a.votes,function(t){return{value:t.percentage,label:t.political_party}}),t.chartData[0].values.sort(function(t,a){return a.value-t.value}))})}}}]),angular.module("wyborySam2014.tables").controller("wyborySam2014.tables.mainCtrl",["$scope",function(t){t.rowCollection=[{firstName:"Laurent",lastName:"Renard",birthDate:new Date("1987-05-21"),balance:102,email:"whatever@gmail.com"},{firstName:"Blandine",lastName:"Faivre",birthDate:new Date("1987-04-25"),balance:-2323.22,email:"oufblandou@gmail.com"},{firstName:"Francoise",lastName:"Frere",birthDate:new Date("1955-08-27"),balance:42343,email:"raymondef@gmail.com"}]}]),angular.module("wyborySam2014.tables").directive("tablesView",[function(){return{scope:{stats:"=",electionKind:"="},controller:"wyborySam2014.tables.mainCtrl",restrict:"E",templateUrl:"tables/main/tables.dir.html",link:function(t,a,e,r){}}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9zb3VyY2UvYXBwLmpzIiwiL3NvdXJjZS9jb25maWcuanMiLCIvc291cmNlL2FyZWEvX2RlZmluaXRpb24uanMiLCIvc291cmNlL2FyZWEvYXJlYS5jdHJsLmpzIiwiL3NvdXJjZS9jaGFydHMvX2RlZmluaXRpb24uanMiLCIvc291cmNlL2h0dHBfc2VydmljZXMvX2RlZmluaXRpb24uanMiLCIvc291cmNlL2h0dHBfc2VydmljZXMvaHR0cC5mYWN0LmpzIiwiL3NvdXJjZS9sYW5kaW5nX3BhZ2UvX2RlZmluaXRpb24uanMiLCIvc291cmNlL2xhbmRpbmdfcGFnZS9sYW5kaW5nLmN0cmwuanMiLCIvc291cmNlL3RhYmxlcy9fZGVmaW5pdGlvbi5qcyIsIi9zb3VyY2UvdXRpbHMvX2RlZmluaXRpb24uanMiLCIvc291cmNlL3V0aWxzL2RhdGEtdXJscy5mYWN0LmpzIiwiL3NvdXJjZS9hcmVhL3RyZWUvbWFpbi1jaXR5LmRpci5qcyIsIi9zb3VyY2UvYXJlYS90cmVlL3RyZWUuZGlyLmpzIiwiL3NvdXJjZS9jaGFydHMvbWFpbi9jaGFydHMuY3RybC5qcyIsIi9zb3VyY2UvY2hhcnRzL21haW4vY2hhcnRzLmRpci5qcyIsIi9zb3VyY2UvdGFibGVzL21haW4vdGFibGVzLmN0cmwuanMiLCIvc291cmNlL3RhYmxlcy9tYWluL3RhYmxlcy5kaXIuanMiXSwibmFtZXMiOlsiYW5ndWxhciIsIm1vZHVsZSIsImNvbnN0YW50IiwiY29uZmlnIiwiJHN0YXRlUHJvdmlkZXIiLCJzdGF0ZSIsInVybCIsImNvbnRyb2xsZXIiLCJ0ZW1wbGF0ZVVybCIsIiRzY29wZSIsIiRyb290U2NvcGUiLCIkaHR0cCIsIiRzdGF0ZVBhcmFtcyIsImh0dHBTZXJ2aWNlIiwidXJscyIsImdldE5hdlRyZWUiLCJ0cmVlIiwib25lVHJlZSIsImZpbHRlciIsIm9iaiIsInR5cGUiLCJlbGVjdGlvbktpbmQiLCJnZXREYXRhIiwibmFtZSIsInNob3dTcGlubmVyIiwiZ2V0U3RhdHNEYXRhIiwic3VjY2VzcyIsInN0YXRzIiwiY29uc29sZSIsImxvZyIsInNpdGVOYW1lIiwiY2hhbmdlRGF0YVVybCIsImRhdGFVcmwiLCJjaGFydERhdGEiLCJrZXkiLCJ2YWx1ZXMiLCJnZXRBcmVhc1RyZWUiLCJkZWNvZGUiLCJnZXRTaXRlTmFtZSIsImdldEVsZWN0aW9uS2luZCIsIm5hdlRyZWUiLCIkd2F0Y2giLCJ2YWwiLCJvbGRWYWwiLCJ1bmRlZmluZWQiLCIkYnJvYWRjYXN0IiwiZGVzIiwiJG9uIiwiZSIsIm1lbnVJc1Zpc2libGUiLCJvcGVuTWVudSIsIm1lbnVJc09mZiIsImRyb3Bkb3duSXNPZmYiLCJlbGVjdGlvbktpbmRzRHJvcHduIiwiZHJvcGRvd25Jc1Zpc2libGUiLCJjaGFuZ2VFbGVjdGlvbktpbmQiLCJraW5kIiwiZGF0YSIsInN0YXRzRGF0YSIsInNjcm9sbFRvIiwiJCIsInZlbG9jaXR5IiwiYXhpcyIsIm9mZnNldCIsImZhY3RvcnkiLCJERVZfQVBJX1BSRUZJWCIsInNlbGYiLCJnZXQiLCIkc3RhdGUiLCJnb3RvU3RhdHMiLCJnbyIsImNvZGUiLCIkbG9jYXRpb24iLCJyZXBsYWNlIiwic3BsaXRVcmxQYXJhbSIsInVybHNBcnIiLCJzcGxpdCIsImRhdGFUeXBlIiwibGVuZ3RoIiwibm9kZSIsIlN0YXRlUGFyYW1EYXRhVXJsIiwic2l0ZVR5cGUiLCJwYXRoIiwicG9wIiwicHVzaCIsImpvaW4iLCJkaXJlY3RpdmUiLCJzY29wZSIsImVsZWN0aW9uIiwicmVzdHJpY3QiLCJsaW5rIiwiaUVsbSIsImlBdHRycyIsImRlYWN0aXZhdGVBbGxCcmFuY2hlcyIsImV2ZW50IiwiZWxlbWVudCIsInN0b3BQcm9wYWdhdGlvbiIsImNoYW5nZUFyZWEiLCJhY3RpdmUiLCJhY3RpdmF0ZURlYWN0aXZhdGUiLCJpbmRleCIsImRlczEiLCJvcHRpb25zIiwiY2hhcnQiLCJoZWlnaHQiLCJtYXJnaW4iLCJ0b3AiLCJyaWdodCIsImJvdHRvbSIsImxlZnQiLCJ4IiwiZCIsImxhYmVsIiwieSIsInZhbHVlIiwic2hvd1ZhbHVlcyIsInZhbHVlRm9ybWF0IiwiZDMiLCJmb3JtYXQiLCJkdXJhdGlvbiIsInhBeGlzIiwieUF4aXMiLCJheGlzTGFiZWxEaXN0YW5jZSIsIl8iLCJtYXAiLCJ2b3RlcyIsInYiLCJwZXJjZW50YWdlIiwicG9saXRpY2FsX3BhcnR5Iiwic29ydCIsImEiLCJiIiwicm93Q29sbGVjdGlvbiIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwiYmlydGhEYXRlIiwiRGF0ZSIsImJhbGFuY2UiLCJlbWFpbCJdLCJtYXBwaW5ncyI6IkFBQUEsWUFDQUEsU0FBQUMsT0FBQSxpQkFDQSxPQUNBLGNBQ0EsWUFDQSxlQUNBLHFCQUNBLHVCQUNBLHVCQUNBLHNCQUNBLHFCQUNBLDhCQUVBQyxTQUFBLGlCQUFBLDhCQUNBQSxTQUFBLG9CQUFBLG9DQ2RBRixRQUFBQyxPQUFBLGlCQUNBRSxRQUFBLGlCQUFBLFNBQUFDLEdBQ0FBLEVBQ0FDLE1BQUEsYUFDQUMsSUFBQSxpQkFDQUMsV0FBQSwwQkFDQUMsWUFBQSx3QkFFQUgsTUFBQSxXQUNBQyxJQUFBLEdBQ0FDLFdBQUEsNkJBQ0FDLFlBQUEsc0NDVkFSLFFBQUFDLE9BQUEseUJDREFELFFBQUFDLE9BQUEsc0JBQ0FNLFdBQUEsMkJBQUEsU0FBQSxhQUFBLFFBQUEsZUFBQSxjQUFBLE9BQ0EsU0FBQUUsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsRUFBQUMsR0FDQSxHQUFBQyxHQUFBLFNBQUFDLEdBQ0EsR0FBQUMsR0FBQUQsRUFBQUUsT0FBQSxTQUFBQyxHQUNBLE1BQUFBLEdBQUFDLE9BQUFYLEVBQUFZLGFBQUFELE9BQ0EsRUFDQSxPQUFBSCxJQUdBSyxFQUFBLFNBQUFoQixFQUFBaUIsR0FDQWQsRUFBQWUsYUFBQSxFQUNBWCxFQUFBWSxhQUFBbkIsR0FBQW9CLFFBQUEsU0FBQUMsR0FDQUMsUUFBQUMsSUFBQXBCLEVBQUFlLGFBQ0FmLEVBQUFrQixNQUFBQSxFQUNBbEIsRUFBQXFCLFNBQUFQLEVBQ0FULEVBQUFpQixjQUFBekIsRUFB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LHdCQUNBcUYsVUFBQSxjQUFBLFdBRUEsT0FDQUMsT0FDQTlCLEtBQUEsS0FFQWxELFdBQUEsZ0NBQ0FrRixTQUFBLElBQ0FqRixZQUFBLDhCQUNBa0YsS0FBQSxTQUFBSCxFQUFBSSxFQUFBQyxFQUFBckYsR0FDQWdGLEVBQUF0RCxZQUFBQyxJQUFBLG9CQUFBQyxZQUNBb0QsRUFBQTlDLE9BQUEsT0FBQSxTQUFBQyxFQUFBQyxHQUNBRCxJQUFBQyxJQUNBNEMsRUFBQXRELFVBQUEsR0FBQUUsT0FBQXdGLEVBQUFDLElBQUFsRixFQUFBbUYsTUFBQSxTQUFBQyxHQUNBLE9BQ0FaLE1BQUFZLEVBQUFDLFdBQ0FmLE1BQUFjLEVBQUFFLG1CQUVBekMsRUFBQXRELFVBQUEsR0FBQUUsT0FBQThGLEtBQUEsU0FBQUMsRUFBQUMsR0FDQSxNQUFBQSxHQUFBakIsTUFBQWdCLEVBQUFoQixnQkNwQkFsSCxRQUFBQyxPQUFBLHdCQUNBTSxXQUFBLGlDQUFBLFNBQUEsU0FBQUUsR0FDQUEsRUFBQTJILGdCQUNBQyxVQUFBLFVBQUFDLFNBQUEsU0FBQUMsVUFBQSxHQUFBQyxNQUFBLGNBQUFDLFFBQUEsSUFBQUMsTUFBQSx1QkFDQUwsVUFBQSxXQUFBQyxTQUFBLFNBQUFDLFVBQUEsR0FBQUMsTUFBQSxjQUFBQyxRQUFBLFNBQUFDLE1BQUEseUJBQ0FMLFVBQUEsWUFBQUMsU0FBQSxRQUFBQyxVQUFBLEdBQUFDLE1BQUEsY0FBQUMsUUFBQSxNQUFBQyxNQUFBLDJCQ0xBMUksUUFBQUMsT0FBQSx3QkFDQXFGLFVBQUEsY0FBQSxXQUNBLE9BQ0FDLE9BQ0E1RCxNQUFBLElBQ0FOLGFBQUEsS0FFQWQsV0FBQSxnQ0FDQWtGLFNBQUEsSUFDQWpGLFlBQUEsOEJBQ0FrRixLQUFBLFNBQUFILEVBQUFJLEVBQUFDLEVBQUFyRiIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuYW5ndWxhci5tb2R1bGUoJ3d5Ym9yeVNhbTIwMTQnLCBbXG4gICdudmQzJyxcbiAgJ3NtYXJ0LXRhYmxlJyxcbiAgJ3VpLnJvdXRlcicsXG4gICd1aS5ib290c3RyYXAnLFxuICAnd3lib3J5U2FtMjAxNC5hcmVhJyxcbiAgJ3d5Ym9yeVNhbTIwMTQuY2hhcnRzJyxcbiAgJ3d5Ym9yeVNhbTIwMTQudGFibGVzJyxcbiAgJ3d5Ym9yeVNhbTIwMTQudXRpbHMnLFxuICAnd3lib3J5U2FtMjAxNC5odHRwJyxcbiAgJ3d5Ym9yeVNhbTIwMTQubGFuZGluZ1BhZ2UnXG4gIF0pXG4uY29uc3RhbnQoJ0RFVl9BUElfUFJFRklYJywgJ2h0dHA6Ly9sb2NhbGhvc3Q6ODA4MS9hcGkvJylcbi5jb25zdGFudCgnSEVST0tVX0FQSV9QUkVGSVgnLCAnd3lyZWN6YW15LXBrdy5oZXJva3VhcHAuY29tL2FwaS8nKTsiLCJhbmd1bGFyLm1vZHVsZSgnd3lib3J5U2FtMjAxNCcpXG4uY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCBmdW5jdGlvbigkc3RhdGVQcm92aWRlcikge1xuICAkc3RhdGVQcm92aWRlclxuICAuc3RhdGUoJ3N0YXRzLWFwcCcsIHtcbiAgICB1cmw6ICcvYXBwL3tkYXRhVXJsfScsXG4gICAgY29udHJvbGxlcjogJ3d5Ym9yeVNhbTIwMTQuYXJlYS5jdHJsJyxcbiAgICB0ZW1wbGF0ZVVybDogJ2FyZWEvYXJlYS5jdHJsLmh0bWwnXG4gIH0pXG4gIC5zdGF0ZSgnbGFuZGluZycsIHtcbiAgICB1cmw6ICcnLFxuICAgIGNvbnRyb2xsZXI6ICd3eWJvcnlTYW0yMDE0LmxhbmRpbmcuY3RybCcsXG4gICAgdGVtcGxhdGVVcmw6ICdsYW5kaW5nX3BhZ2UvbGFuZGluZy5jdHJsLmh0bWwnXG4gIH0pXG59XSkiLCIndXNlIHN0cmljdCc7XG5hbmd1bGFyLm1vZHVsZSgnd3lib3J5U2FtMjAxNC5hcmVhJywgW10pIiwiYW5ndWxhci5tb2R1bGUoJ3d5Ym9yeVNhbTIwMTQuYXJlYScpXG4uY29udHJvbGxlcignd3lib3J5U2FtMjAxNC5hcmVhLmN0cmwnLCBbJyRzY29wZScsICckcm9vdFNjb3BlJywgJyRodHRwJywgJyRzdGF0ZVBhcmFtcycsICdodHRwU2VydmljZScsICd1cmxzJyxcbiAgZnVuY3Rpb24oJHNjb3BlLCAkcm9vdFNjb3BlLCAkaHR0cCwgJHN0YXRlUGFyYW1zLCBodHRwU2VydmljZSwgdXJscyl7XG4gIHZhciBnZXROYXZUcmVlID0gZnVuY3Rpb24odHJlZSkge1xuICAgIHZhciBvbmVUcmVlID0gdHJlZS5maWx0ZXIoZnVuY3Rpb24ob2JqKXtcbiAgICAgIHJldHVybiBvYmoudHlwZSA9PT0gJHNjb3BlLmVsZWN0aW9uS2luZC50eXBlO1xuICAgIH0pWzBdO1xuICAgIHJldHVybiBvbmVUcmVlO1xuICB9O1xuXG4gIHZhciBnZXREYXRhID0gZnVuY3Rpb24gKHVybCwgbmFtZSkge1xuICAgICRzY29wZS5zaG93U3Bpbm5lciA9IHRydWU7XG4gICAgaHR0cFNlcnZpY2UuZ2V0U3RhdHNEYXRhKHVybCkuc3VjY2VzcyhmdW5jdGlvbihzdGF0cyl7XG4gICAgICBjb25zb2xlLmxvZygkc2NvcGUuc2hvd1NwaW5uZXIpO1xuICAgICAgJHNjb3BlLnN0YXRzID0gc3RhdHM7XG4gICAgICAkc2NvcGUuc2l0ZU5hbWUgPSBuYW1lO1xuICAgICAgdXJscy5jaGFuZ2VEYXRhVXJsKHVybCwgJHNjb3BlLmRhdGFVcmwsICdzdGF0cycpO1xuICAgICAgJHNjb3BlLnNob3dTcGlubmVyID0gZmFsc2U7XG4gICAgfSlcbiAgfTtcblxuICAkc2NvcGUuY2hhcnREYXRhID0ge2tleTogJycsIHZhbHVlczogW119O1xuICAkc2NvcGUuZGF0YVVybCA9ICRzdGF0ZVBhcmFtcy5kYXRhVXJsO1xuICAkc2NvcGUuc2hvd1NwaW5uZXIgPSBmYWxzZTtcblxuICBodHRwU2VydmljZS5nZXRBcmVhc1RyZWUoKS5zdWNjZXNzKGZ1bmN0aW9uKHRyZWUpIHtcbiAgICAkc2NvcGUudHJlZSA9IHRyZWU7XG4gICAgXG4gICAgdmFyIHVybCA9IHVybHMuZGVjb2RlKCRzdGF0ZVBhcmFtcy5kYXRhVXJsKTtcbiAgICB2YXIgbmFtZSA9IHVybHMuZ2V0U2l0ZU5hbWUodXJsKTtcbiAgICAvLyBjb25zb2xlLmxvZygpO1xuICAgICRzY29wZS5lbGVjdGlvbktpbmQgPSB1cmxzLmdldEVsZWN0aW9uS2luZCh0cmVlLCB1cmwpO1xuICAgICRzY29wZS5uYXZUcmVlID0gZ2V0TmF2VHJlZSh0cmVlKTtcbiAgICBnZXREYXRhKHVybCwgbmFtZSk7XG4gIH0pO1xuXG4gICRzY29wZS4kd2F0Y2goJ2VsZWN0aW9uS2luZCcsIGZ1bmN0aW9uKHZhbCwgb2xkVmFsKSB7XG4gICAgaWYodmFsICE9PSBvbGRWYWwgJiYgb2xkVmFsICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICRzY29wZS5uYXZUcmVlID0gZ2V0TmF2VHJlZSgkc2NvcGUudHJlZSk7XG4gICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ2FyZWE6OmVsZWN0aW9uVHlwZUNoYW5nZScpO1xuICAgICAgZ2V0RGF0YSgkc2NvcGUuZWxlY3Rpb25LaW5kLnVybCwgJ1dhcnN6YXdhJyk7XG4gICAgfVxuICB9KTtcblxuICB2YXIgZGVzID0gJHJvb3RTY29wZS4kb24oJ2FyZWE6OmFyZWFUeXBlQ2hhbmdlJywgZnVuY3Rpb24oZSwgdXJsLCBuYW1lKXtcbiAgICBnZXREYXRhKHVybCwgbmFtZSlcbiAgfSk7XG4gICRzY29wZS4kb24oJyRkZXN0cm95JywgZGVzKTtcblxuICAkc2NvcGUubWVudUlzVmlzaWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAkc2NvcGUub3Blbk1lbnUgPT09IGZhbHNlIHx8ICRzY29wZS5vcGVuTWVudSA9PT0gdHJ1ZTtcbiAgfTtcbiAgJHNjb3BlLm1lbnVJc09mZiA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAkc2NvcGUub3Blbk1lbnUgPT09IGZhbHNlO1xuICB9O1xuICBcbiAgJHNjb3BlLmRyb3Bkb3duSXNPZmYgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gJHNjb3BlLmVsZWN0aW9uS2luZHNEcm9wd24gPT09IGZhbHNlO1xuICB9O1xuXG4gICRzY29wZS5kcm9wZG93bklzVmlzaWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiAkc2NvcGUuZWxlY3Rpb25LaW5kc0Ryb3B3biA9PT0gZmFsc2UgfHwgJHNjb3BlLmVsZWN0aW9uS2luZHNEcm9wd24gPT09IHRydWU7XG4gIH07XG5cbiAgJHNjb3BlLmNoYW5nZUVsZWN0aW9uS2luZCA9IGZ1bmN0aW9uKGtpbmQpIHtcbiAgICAkc2NvcGUuZGF0YVVybCA9IGtpbmQudXJsO1xuICAgICRzY29wZS5lbGVjdGlvbktpbmQgPSB7XG4gICAgICBuYW1lOiBraW5kLm5hbWUsXG4gICAgICB0eXBlOiBraW5kLnR5cGUsXG4gICAgICB1cmw6IGtpbmQudXJsXG4gICAgfTtcbiAgICBodHRwU2VydmljZS5nZXRTdGF0c0RhdGEoa2luZC51cmwpLnN1Y2Nlc3MoZnVuY3Rpb24oZGF0YSl7XG4gICAgICAkc2NvcGUuc3RhdHNEYXRhID0gZGF0YTtcbiAgICB9KVxuICAgIHVybHMuY2hhbmdlRGF0YVVybChraW5kLnVybCwgJ3N0YXRzJyk7XG4gICAgJHNjb3BlLmVsZWN0aW9uS2luZHNEcm9wd24gPSBmYWxzZTtcbiAgfTtcbiAgXG4gICRzY29wZS5zY3JvbGxUbyA9IGZ1bmN0aW9uKGtpbmQpIHtcbiAgICBpZihraW5kID09PSAnI2NoYXJ0cycpIHtcbiAgICAgICQoa2luZCkudmVsb2NpdHkoXCJzY3JvbGxcIiwgeyBheGlzOiBcInlcIiwgb2Zmc2V0OiAtMTQwfSlcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgJChraW5kKS52ZWxvY2l0eShcInNjcm9sbFwiLCB7IGF4aXM6IFwieVwiLCBvZmZzZXQ6IC02MH0pXG5cblxuICB9XG5cbiAgXG4gIFxufV0pOyIsIid1c2Ugc3RyaWN0JztcbmFuZ3VsYXIubW9kdWxlKCd3eWJvcnlTYW0yMDE0LmNoYXJ0cycsIFtdKSIsIid1c2Ugc3RyaWN0JztcbmFuZ3VsYXIubW9kdWxlKCd3eWJvcnlTYW0yMDE0Lmh0dHAnLCBbXSkiLCJhbmd1bGFyLm1vZHVsZSgnd3lib3J5U2FtMjAxNC5odHRwJylcbi5mYWN0b3J5KCdodHRwU2VydmljZScsIFsnJGh0dHAnLCAnREVWX0FQSV9QUkVGSVgnLCBmdW5jdGlvbigkaHR0cCwgREVWX0FQSV9QUkVGSVgpIHtcbiAgdmFyIHNlbGYgPSB7fTtcbiAgXG4gIHNlbGYuZ2V0QXJlYXNUcmVlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICRodHRwLmdldChERVZfQVBJX1BSRUZJWCArICdzdGF0cy9hcmVhcy10cmVlLycpO1xuICB9O1xuXG4gIHNlbGYuZ2V0U3RhdHNEYXRhID0gZnVuY3Rpb24odXJsKSB7XG4gICAgcmV0dXJuICRodHRwLmdldChERVZfQVBJX1BSRUZJWCArIHVybCk7XG4gIH07XG5cbiAgcmV0dXJuIHNlbGY7XG59XSkiLCIndXNlIHN0cmljdCc7XG5hbmd1bGFyLm1vZHVsZSgnd3lib3J5U2FtMjAxNC5sYW5kaW5nUGFnZScsIFtdKSIsIid1c2Ugc3RyaWN0JztcbmFuZ3VsYXIubW9kdWxlKCd3eWJvcnlTYW0yMDE0LmxhbmRpbmdQYWdlJylcbi5jb250cm9sbGVyKCd3eWJvcnlTYW0yMDE0LmxhbmRpbmcuY3RybCcsIFsnJHNjb3BlJywgJyRzdGF0ZScsJ2h0dHBTZXJ2aWNlJywgJ3VybHMnLFxuZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsIGh0dHBTZXJ2aWNlLCB1cmxzKXtcbiAgaHR0cFNlcnZpY2UuZ2V0QXJlYXNUcmVlKCkuc3VjY2VzcyhmdW5jdGlvbih0cmVlKSB7XG4gICAgJHNjb3BlLnRyZWUgPSB0cmVlO1xuICB9KTtcbiAgJHNjb3BlLmRhdGEgPSBudWxsO1xuICAkc2NvcGUuZ290b1N0YXRzID0gZnVuY3Rpb24odXJsKSB7XG4gICAgaWYoIXVybCkge1xuICAgICAgdXJsID0gJ3N0YXRzL2NpdHlfY291bmNpbC9jaXJjbGUtMS8nO1xuICAgIH1cbiAgICAkc3RhdGUuZ28oJ3N0YXRzLWFwcCcsIHtkYXRhVXJsOiB1cmxzLmNvZGUodXJsKX0pO1xuICB9O1xufV0pIiwiJ3VzZSBzdHJpY3QnO1xuYW5ndWxhci5tb2R1bGUoJ3d5Ym9yeVNhbTIwMTQudGFibGVzJywgW10pIiwiJ3VzZSBzdHJpY3QnO1xuYW5ndWxhci5tb2R1bGUoJ3d5Ym9yeVNhbTIwMTQudXRpbHMnLCBbXSkiLCIndXNlIHN0cmljdCc7XG5hbmd1bGFyLm1vZHVsZSgnd3lib3J5U2FtMjAxNC51dGlscycpXG4uZmFjdG9yeSgndXJscycsIFsnJGxvY2F0aW9uJywgZnVuY3Rpb24oJGxvY2F0aW9uKXtcbiAgdmFyIHNlbGYgPSB7fTtcbiAgXG4gIHNlbGYuY29kZSA9IGZ1bmN0aW9uKHVybCkge1xuICAgIHJldHVybiB1cmwucmVwbGFjZSgvXFwvL2csICcuJyk7XG4gIH07XG4gIFxuICBzZWxmLmRlY29kZSA9IGZ1bmN0aW9uKHVybCkge1xuICAgIHJldHVybiB1cmwucmVwbGFjZSgvXFwuL2csICcvJyk7XG4gIH07XG5cbiAgc2VsZi5nZXRTaXRlTmFtZSA9IGZ1bmN0aW9uKHVybCwgc3BsaXRVcmxQYXJhbSkge1xuICAgIGlmKHVybCkge1xuICAgICAgdmFyIHVybHNBcnIgPSB1cmwuc3BsaXQoc3BsaXRVcmxQYXJhbSB8fCAnLycpO1xuICAgICAgdmFyIGRhdGFUeXBlID0gdXJsc0Fyclt1cmxzQXJyLmxlbmd0aCAtIDJdLnNwbGl0KCctJyk7ICBcbiAgICB9XG5cbiAgICBpZih1cmwgJiYgZGF0YVR5cGVbMF0gPT09ICdjaXJjbGUnKSB7XG4gICAgICByZXR1cm4gJ09rcsSZZyBuciAnICsgZGF0YVR5cGVbMV07XG4gICAgfVxuICAgIGVsc2UgaWYodXJsICYmIGRhdGFUeXBlWzBdID09PSAnY2lyY3VpdCcpIHtcbiAgICAgIHJldHVybiAnT2J3w7NkIG5yICcgKyAgZGF0YVR5cGVbMV07XG4gICAgfVxuICAgIGVsc2UgaWYodXJsICYmIGRhdGFUeXBlWzBdID09PSAnZGlzdHJpY3QnKSB7XG4gICAgICByZXR1cm4gZGF0YVR5cGVbMV07XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgcmV0dXJuICdXYXJzemF3YSc7XG4gICAgfVxuICB9O1xuXG4gIHNlbGYuZ2V0RWxlY3Rpb25LaW5kID0gZnVuY3Rpb24odHJlZSwgdXJsLCBzcGxpdFVybFBhcmFtKSB7XG4gICAgaWYoIXVybCB8fCAhdHJlZSkge1xuICAgICAgcmV0dXJuIHsgLy9kZWZhdWx0IGRhdGFcbiAgICAgICAgbmFtZTogJ1d5Ym9yeSBkbyBSYWR5IE1pYXN0YScsXG4gICAgICAgIHR5cGU6ICdjaXR5X2NvdW5jaWwnLFxuICAgICAgICB1cmw6ICdzdGF0cy9jaXR5X2NvdW5jaWwvJ1xuICAgICAgfVxuICAgIH1cblxuICAgIHZhciB0eXBlID0gdXJsLnNwbGl0KHNwbGl0VXJsUGFyYW0gfHwgJy8nKVsxXTtcbiAgICB2YXIgbm9kZSA9IHRyZWUuZmlsdGVyKGZ1bmN0aW9uKG9iail7XG4gICAgICByZXR1cm4gb2JqLnR5cGUgPT09IHR5cGU7XG4gICAgfSlbMF07XG4gICAgcmV0dXJuIHtcbiAgICAgIG5hbWU6IG5vZGUubmFtZSxcbiAgICAgIHR5cGU6IG5vZGUudHlwZSxcbiAgICAgIHVybDogbm9kZS51cmxcbiAgICB9O1xuICB9XG5cbiAgc2VsZi5jaGFuZ2VEYXRhVXJsID0gZnVuY3Rpb24odXJsLCBTdGF0ZVBhcmFtRGF0YVVybCwgc2l0ZVR5cGUpIHtcbiAgICBcbiAgICB2YXIgZGF0YVVybCA9ICRsb2NhdGlvbi5wYXRoKCkuc3BsaXQoJy8nKTtcbiAgICBcbiAgICAvL2l0IGlzIGRhbmdlcm91cyBidXQgbm93IHdvcmtzIFxuICAgIGRhdGFVcmwucG9wKCk7XG4gICAgXG4gICAgZGF0YVVybC5wdXNoKHNlbGYuY29kZSh1cmwpKTtcbiAgICAkbG9jYXRpb24ucGF0aChkYXRhVXJsLmpvaW4oJy8nKSk7XG4gIH1cblxuICByZXR1cm4gc2VsZjtcbn1dKSIsIid1c2Ugc3RyaWN0JztcbmFuZ3VsYXIubW9kdWxlKCd3eWJvcnlTYW0yMDE0LmFyZWEnKVxuLmRpcmVjdGl2ZSgnbWFpbkNpdHknLCBbJyRyb290U2NvcGUnLCBmdW5jdGlvbigkcm9vdFNjb3BlKXtcbiAgcmV0dXJuIHtcbiAgICBzY29wZToge1xuICAgICAgZWxlY3Rpb246XCI9XCJcbiAgICB9LCAvLyB7fSA9IGlzb2xhdGUsIHRydWUgPSBjaGlsZCwgZmFsc2UvdW5kZWZpbmVkID0gbm8gY2hhbmdlXG4gICAgcmVzdHJpY3Q6ICdFJywgLy8gRSA9IEVsZW1lbnQsIEEgPSBBdHRyaWJ1dGUsIEMgPSBDbGFzcywgTSA9IENvbW1lbnRcbiAgICB0ZW1wbGF0ZVVybDogJ2FyZWEvdHJlZS9tYWluLWNpdHkuZGlyLmh0bWwnLFxuICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBpRWxtLCBpQXR0cnMsIGNvbnRyb2xsZXIpIHtcbiAgICAgIHNjb3BlLmRlYWN0aXZhdGVBbGxCcmFuY2hlcyA9IGZ1bmN0aW9uKGV2ZW50LCBlbGVtZW50KSB7XG4gICAgICAgIGV2ZW50LnN0b3BQcm9wYWdhdGlvbigpO1xuICAgICAgICAkcm9vdFNjb3BlLiRicm9hZGNhc3QoJ3RyZWUuY2l0eTo6ZGVhY3RpdmF0ZUFsbEJyYW5jaGVzJykgXG4gICAgICB9XG5cbiAgICAgIHNjb3BlLmNoYW5nZUFyZWEgPSBmdW5jdGlvbihldmVudCwgZWxlbWVudCkge1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICAgICAgJHJvb3RTY29wZS4kYnJvYWRjYXN0KCdhcmVhOjphcmVhVHlwZUNoYW5nZScsIGVsZW1lbnQudXJsLCBlbGVtZW50Lm5hbWUpO1xuICAgICAgfTsgIFxuICAgIH1cbiAgfTtcbn1dKTsiLCIndXNlIHN0cmljdCc7XG5hbmd1bGFyLm1vZHVsZSgnd3lib3J5U2FtMjAxNC5hcmVhJylcbi5kaXJlY3RpdmUoJ2FyZWFzVHJlZScsIFsnJHJvb3RTY29wZScsIGZ1bmN0aW9uKCRyb290U2NvcGUpe1xuICByZXR1cm4ge1xuICAgIHNjb3BlOiB7XG4gICAgICB0cmVlOlwiPVwiXG4gICAgfSwgLy8ge30gPSBpc29sYXRlLCB0cnVlID0gY2hpbGQsIGZhbHNlL3VuZGVmaW5lZCA9IG5vIGNoYW5nZVxuICAgIHJlc3RyaWN0OiAnRScsIC8vIEUgPSBFbGVtZW50LCBBID0gQXR0cmlidXRlLCBDID0gQ2xhc3MsIE0gPSBDb21tZW50XG4gICAgdGVtcGxhdGVVcmw6ICdhcmVhL3RyZWUvdHJlZS5kaXIuaHRtbCcsXG4gICAgbGluazogZnVuY3Rpb24oc2NvcGUsIGlFbG0sIGlBdHRycywgY29udHJvbGxlcikge1xuICAgICAgc2NvcGUuYWN0aXZlID0gLTE7XG4gICAgICBzY29wZS5hY3RpdmF0ZURlYWN0aXZhdGUgPSBmdW5jdGlvbihldmVudCwgaW5kZXgpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgIGlmKHNjb3BlLmFjdGl2ZSA9PT0gLTEpIHtcbiAgICAgICAgICBzY29wZS5hY3RpdmUgPSBpbmRleDtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgc2NvcGUuYWN0aXZlID0gLTE7XG4gICAgICB9O1xuXG4gICAgICB2YXIgZGVzID0gJHJvb3RTY29wZS4kb24oJ2FyZWE6OmVsZWN0aW9uVHlwZUNoYW5nZScsIGZ1bmN0aW9uKCl7XG4gICAgICAgIHNjb3BlLmFjdGl2ZSA9IC0xO1xuICAgICAgfSk7XG4gICAgICBzY29wZS4kb24oJyRkZXN0cm95JywgZGVzKTtcbiAgICAgIFxuICAgICAgdmFyIGRlczEgPSAkcm9vdFNjb3BlLiRvbigndHJlZS5jaXR5OjpkZWFjdGl2YXRlQWxsQnJhbmNoZXMnLCBmdW5jdGlvbigpe1xuICAgICAgICBzY29wZS5hY3RpdmUgPSAtMTtcbiAgICAgIH0pO1xuICAgICAgc2NvcGUuJG9uKCckZGVzdHJveScsIGRlczEpO1xuXG4gICAgICBzY29wZS5jaGFuZ2VBcmVhID0gZnVuY3Rpb24oZXZlbnQsIGVsZW1lbnQpIHtcbiAgICAgICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgICAgICRyb290U2NvcGUuJGJyb2FkY2FzdCgnYXJlYTo6YXJlYVR5cGVDaGFuZ2UnLCBlbGVtZW50LnVybCwgZWxlbWVudC5uYW1lKTtcbiAgICAgIH07XG5cbiAgICAgIFxuICAgIH1cbiAgfTtcbn1dKTsiLCIndXNlIHN0cmljdCc7XG5hbmd1bGFyLm1vZHVsZSgnd3lib3J5U2FtMjAxNC5jaGFydHMnKVxuLmNvbnRyb2xsZXIoJ3d5Ym9yeVNhbTIwMTQuY2hhcnRzLm1haW5DdHJsJywgWyckc2NvcGUnLCBmdW5jdGlvbigkc2NvcGUpIHtcbiAgXG4gICRzY29wZS5vcHRpb25zID0ge1xuICAgIGNoYXJ0OiB7XG4gICAgICB0eXBlOiAnZGlzY3JldGVCYXJDaGFydCcsXG4gICAgICBoZWlnaHQ6IDQwMCxcbiAgICAgIG1hcmdpbiA6IHtcbiAgICAgICAgdG9wOiAyMCxcbiAgICAgICAgcmlnaHQ6IDQwLFxuICAgICAgICBib3R0b206IDUwLFxuICAgICAgICBsZWZ0OiA1NVxuICAgICAgfSxcbiAgICAgIHg6IGZ1bmN0aW9uKGQpe3JldHVybiBkLmxhYmVsO30sXG4gICAgICB5OiBmdW5jdGlvbihkKXtyZXR1cm4gZC52YWx1ZTt9LFxuICAgICAgc2hvd1ZhbHVlczogZmFsc2UsXG4gICAgICB2YWx1ZUZvcm1hdDogZnVuY3Rpb24oZCl7XG4gICAgICAgIHJldHVybiBkMy5mb3JtYXQoJywuMmYlJykoZCk7XG4gICAgICB9LFxuICAgICAgZHVyYXRpb246IDUwMCxcbiAgICAgIHhBeGlzOiB7XG4gICAgICAgIC8vIGF4aXNMYWJlbDogJ1ggQXhpcydcbiAgICAgIH0sXG4gICAgICB5QXhpczoge1xuICAgICAgICAvLyBheGlzTGFiZWw6ICdZIEF4aXMnLFxuICAgICAgICBheGlzTGFiZWxEaXN0YW5jZTogMFxuICAgICAgfSxcbiAgICB9XG4gIH07XG59XSkiLCIndXNlIHN0cmljdCc7XG5hbmd1bGFyLm1vZHVsZSgnd3lib3J5U2FtMjAxNC5jaGFydHMnKVxuLmRpcmVjdGl2ZSgnY2hhcnRzVmlldycsIFtmdW5jdGlvbigpe1xuICAvLyBSdW5zIGR1cmluZyBjb21waWxlXG4gIHJldHVybiB7XG4gICAgc2NvcGU6IHtcbiAgICAgIGRhdGE6ICc9J1xuICAgIH0sIC8vIHt9ID0gaXNvbGF0ZSwgdHJ1ZSA9IGNoaWxkLCBmYWxzZS91bmRlZmluZWQgPSBubyBjaGFuZ2VcbiAgICBjb250cm9sbGVyOiAnd3lib3J5U2FtMjAxNC5jaGFydHMubWFpbkN0cmwnLFxuICAgIHJlc3RyaWN0OiAnRScsIC8vIEUgPSBFbGVtZW50LCBBID0gQXR0cmlidXRlLCBDID0gQ2xhc3MsIE0gPSBDb21tZW50XG4gICAgdGVtcGxhdGVVcmw6ICdjaGFydHMvbWFpbi9jaGFydHMuZGlyLmh0bWwnLFxuICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBpRWxtLCBpQXR0cnMsIGNvbnRyb2xsZXIpIHtcbiAgICAgIHNjb3BlLmNoYXJ0RGF0YSA9IFt7a2V5OiBcIkN1bXVsYXRpdmUgUmV0dXJuXCIsIHZhbHVlczogW119XVxuICAgICAgc2NvcGUuJHdhdGNoKCdkYXRhJywgZnVuY3Rpb24odmFsLCBvbGRWYWwpIHtcbiAgICAgICAgaWYodmFsICE9PSBvbGRWYWwpIHtcbiAgICAgICAgICBzY29wZS5jaGFydERhdGFbMF0udmFsdWVzID0gXy5tYXAodmFsLnZvdGVzLGZ1bmN0aW9uKHYpe1xuICAgICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgICAgdmFsdWU6IHYucGVyY2VudGFnZSxcbiAgICAgICAgICAgICAgbGFiZWw6IHYucG9saXRpY2FsX3BhcnR5XG4gICAgICAgICAgfX0pXG4gICAgICAgICAgc2NvcGUuY2hhcnREYXRhWzBdLnZhbHVlcy5zb3J0KGZ1bmN0aW9uKGEsIGIpe1xuICAgICAgICAgICAgcmV0dXJuIGIudmFsdWUgLSBhLnZhbHVlO1xuICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcbn1dKTsiLCIndXNlIHN0cmljdCc7XG5hbmd1bGFyLm1vZHVsZSgnd3lib3J5U2FtMjAxNC50YWJsZXMnKVxuLmNvbnRyb2xsZXIoJ3d5Ym9yeVNhbTIwMTQudGFibGVzLm1haW5DdHJsJywgWyckc2NvcGUnLCBmdW5jdGlvbigkc2NvcGUpe1xuICAkc2NvcGUucm93Q29sbGVjdGlvbiA9IFtcbiAgICB7Zmlyc3ROYW1lOiAnTGF1cmVudCcsIGxhc3ROYW1lOiAnUmVuYXJkJywgYmlydGhEYXRlOiBuZXcgRGF0ZSgnMTk4Ny0wNS0yMScpLCBiYWxhbmNlOiAxMDIsIGVtYWlsOiAnd2hhdGV2ZXJAZ21haWwuY29tJ30sXG4gICAge2ZpcnN0TmFtZTogJ0JsYW5kaW5lJywgbGFzdE5hbWU6ICdGYWl2cmUnLCBiaXJ0aERhdGU6IG5ldyBEYXRlKCcxOTg3LTA0LTI1JyksIGJhbGFuY2U6IC0yMzIzLjIyLCBlbWFpbDogJ291ZmJsYW5kb3VAZ21haWwuY29tJ30sXG4gICAge2ZpcnN0TmFtZTogJ0ZyYW5jb2lzZScsIGxhc3ROYW1lOiAnRnJlcmUnLCBiaXJ0aERhdGU6IG5ldyBEYXRlKCcxOTU1LTA4LTI3JyksIGJhbGFuY2U6IDQyMzQzLCBlbWFpbDogJ3JheW1vbmRlZkBnbWFpbC5jb20nfVxuICBdO1xufV0pIiwiJ3VzZSBzdHJpY3QnO1xuYW5ndWxhci5tb2R1bGUoJ3d5Ym9yeVNhbTIwMTQudGFibGVzJylcbi5kaXJlY3RpdmUoJ3RhYmxlc1ZpZXcnLCBbZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHtcbiAgICBzY29wZToge1xuICAgICAgc3RhdHM6IFwiPVwiLFxuICAgICAgZWxlY3Rpb25LaW5kOiBcIj1cIlxuICAgICAgfSwgLy8ge30gPSBpc29sYXRlLCB0cnVlID0gY2hpbGQsIGZhbHNlL3VuZGVmaW5lZCA9IG5vIGNoYW5nZVxuICAgIGNvbnRyb2xsZXI6ICd3eWJvcnlTYW0yMDE0LnRhYmxlcy5tYWluQ3RybCcsXG4gICAgcmVzdHJpY3Q6ICdFJywgLy8gRSA9IEVsZW1lbnQsIEEgPSBBdHRyaWJ1dGUsIEMgPSBDbGFzcywgTSA9IENvbW1lbnQsXG4gICAgdGVtcGxhdGVVcmw6ICd0YWJsZXMvbWFpbi90YWJsZXMuZGlyLmh0bWwnLFxuICAgIGxpbms6IGZ1bmN0aW9uKHNjb3BlLCBpRWxtLCBpQXR0cnMsIGNvbnRyb2xsZXIpIHtcbiAgICAgIC8vIHNjb3BlLmNhbmRpZGF0ZXNUYWJsZUxpbWl0ID0gMzA7XG4gICAgfVxuICB9O1xufV0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
